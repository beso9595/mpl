<html>

<head>
    <title>mpl</title>
    <style>
        body {
            padding: 50px;
            font: 14px "Lucida Grande", Helvetica, Arial, sans-serif;
        }

        a {
            color: #00B7FF;
        }

        .record:hover {
            background-color: red;
            cursor: pointer;
        }
    </style>
    <script>
        const buildList = data => {
            const thead = document.createElement('thead');
            const theadTr = document.createElement('tr');
            const nameTh = document.createElement('th');
            nameTh.innerText = 'Name';
            theadTr.appendChild(nameTh);
            thead.appendChild(theadTr);
            //
            const tbody = document.createElement('tbody');
            data.forEach(m => {
                const tbodyTr = document.createElement('tr');
                tbodyTr.setAttribute('class', 'record')
                const nameTd = document.createElement('td');
                nameTd.innerText = m;
                nameTd.addEventListener('click', () => {
                    play(m);
                });
                tbodyTr.appendChild(nameTd);
                tbody.appendChild(tbodyTr);
            });
            //
            const listEl = document.getElementById('list');
            listEl.innerHTML = '';
            listEl.append(thead);
            listEl.append(tbody);
            listEl.hidden = false;
        };
        //
        const onSearch = () => {
            const loaderEl = document.getElementById('loader');
            const listEl = document.getElementById('list');
            loaderEl.hidden = false;
            listEl.hidden = true;
            //
            const folder = document.getElementById('folder').value;
            const xhr = new XMLHttpRequest();
            xhr.addEventListener("load", (e) => {
                if (e.target.status === 200) {
                    buildList(JSON.parse(e.target.response));
                } else {
                    alert('error');
                }
                loaderEl.hidden = true;
            });
            xhr.open('GET', `/list/${folder}`);
            xhr.send();
        }
        //
        const play = music => {
            const folder = document.getElementById('folder').value;
            const audio = document.getElementById('player');
            audio.pause();
            audio.src = `/file/${folder}/${music}`;
            audio.play();
        }
    </script>
</head>
<body>
<audio id="player" src="" style="width: 100%" controls>
    Your browser does not support the audio element.
</audio>
<br>
<br>
<select id="folder">
    <option value="Music">Music</option>
    <option value="Downloads" selected>Downloads</option>
</select>
<br>
<br>
<button onclick="onSearch()">Search</button>
<br>
<br>
<div id="loader" hidden>Loading..</div>
<table id="list"></table>
</body>

</html>
